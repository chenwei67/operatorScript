"database","view","engine","create_table_query_one_line"
"dspm","http_log_statistics_by_day_mv","MaterializedView","CREATE MATERIALIZED VIEW dspm.http_log_statistics_by_day_mv TO dspm.http_log_statistics_by_day_local (`createDay` DateTime, `xSrcIp` LowCardinality(String), `xDstIp` LowCardinality(String), `srcIpTag` Int32, `dstPort` Int32, `apiId` String, `xAppId` String, `accountId` String, `xUserId` String, `xUserGroupId` String, `countCountState` AggregateFunction(count, UInt8)) AS SELECT toStartOfDay(toDateTime(recordTimestamp)) AS createDay, srcIp AS xSrcIp, dstIp AS xDstIp, srcIpTag, dstPort, apiId, xAppId, accountId, xUserId, xUserGroupId, countState(1) AS countCountState FROM business.dsp_http_log_local WHERE (xAppId IS NOT NULL) AND (xAppId != '') AND (apiId IS NOT NULL) AND (apiId != '') GROUP BY createDay, xAppId, apiId, srcIp, dstIp, accountId, xUserId, xUserGroupId, srcIpTag, dstPort"
"dspm","label_count_by_day_mv","MaterializedView","CREATE MATERIALIZED VIEW dspm.label_count_by_day_mv TO dspm.label_count_by_day_local (`appId` String, `apiId` String, `accountId` String, `xForwardIp` LowCardinality(String), `srcIp` String, `dstIp` LowCardinality(String), `apiTags` Array(Int32), `srcIpTag` Int32, `userId` String, `userRole` String, `groupPath` String, `groupId` String, `createDay` DateTime, `labelId` String, `paramsType` UInt8, `labelCount` AggregateFunction(sum, Int32)) AS SELECT xAppId AS appId, apiId, accountId, business.dsp_http_log_local.srcIp AS xForwardIp, JSONExtractString(extensions, 'xSrcIp') AS srcIp, dstIp, apiTags, srcIpTag, xUserId AS userId, arrayJoin(if((length(xUserRoles) = 0) OR (xUserRoles IS NULL), [''], xUserRoles)) AS userRole, xUserGroup AS groupPath, xUserGroupId AS groupId, toDate(recordTimestamp) AS createDay, tuple.1 AS labelId, tuple.3 AS paramsType, sumState(tuple.2) AS labelCount FROM business.dsp_http_log_local ARRAY JOIN arrayConcat(arrayMap((x, y) -> (x, y, 1), respDataLabelIds, respDataCounts), arrayMap((x, y) -> (x, y, 0), reqDataLabelIds, reqDataCounts)) AS tuple WHERE (((respDataClassifications != []) AND (respDataLabelIds != [])) OR ((reqDataLabelIds != []) AND (reqDataClassifications != []))) AND (xAppId != '') AND (xAppId IS NOT NULL) AND (apiId != '') AND (apiId IS NOT NULL) AND (respDataGrade > 0) GROUP BY createDay, appId, apiId, srcIp, xForwardIp, dstIp, labelId, accountId, userId, groupId, userRole, groupPath, paramsType, apiTags, srcIpTag"
"metric","dev_report_status_local","MaterializedView","CREATE MATERIALIZED VIEW metric.dev_report_status_local (`tenant` LowCardinality(String), `deviceId` LowCardinality(String), `productType` LowCardinality(String), `srcIp` String, `source` LowCardinality(String), `cloudRecieveTimestamp` UInt64, `heartbeatTimestamp` UInt64) ENGINE = ReplacingMergeTree(cloudRecieveTimestamp) PARTITION BY tenant PRIMARY KEY cloudRecieveTimestamp ORDER BY (cloudRecieveTimestamp, tenant, deviceId, productType) SETTINGS allow_nullable_key = 1, index_granularity = 8192 AS SELECT tenant, deviceId, productType, srcIp, gateway AS source, max(cloudRecieveTimestamp) AS cloudRecieveTimestamp, max(heartbeatTimestamp) AS heartbeatTimestamp FROM business.report_audit_log_local GROUP BY tenant, deviceId, productType, srcIp, source"
